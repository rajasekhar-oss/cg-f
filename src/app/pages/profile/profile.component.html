<app-error-notification *ngIf="showNotification" [message]="notificationMessage" (closed)="onNotificationClosed()"></app-error-notification>
          <!-- Remove duplicate file upload input -->
<!-- Navigation Bar -->
 <app-top-nav
  [topNavItems]="bottomNavItems"
  [isActiveRoute]="isActiveRoute.bind(this)"
  [navigate]="navigate.bind(this)">
</app-top-nav>

<!-- Main Content -->
<div class="main-content">
  <div class="container">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center" style="padding: 48px 0;">
      <div style="font-size: 18px; color: #6b7280;">Loading profile...</div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="text-center" style="padding: 48px 0;">
      <div style="color: #dc2626; font-size: 18px; margin-bottom: 16px;">{{ error }}</div>
      <button (click)="loadProfile()" class="btn btn-primary">Retry</button>
    </div>

    <!-- Profile Content -->
    <div *ngIf="profile && !isLoading" style="max-width: 800px; margin: 0 auto;">
      
      <!-- Profile Header -->
      <div class="card mb-8">
        <div class="profile-header">
          <div class="profile-picture-container">
            <img 
              *ngIf="profile.imageUrl" 
              [src]="profile.imageUrl" 
              [alt]="getDisplayName() + ' profile picture'"
              class="profile-picture"
              (error)="onImageError($event)">
            <div 
              *ngIf="!profile.imageUrl" 
              class="profile-initials">
              {{ getUserInitials() }}
            </div>
          </div>
          <div class="profile-info">
            <h2 class="profile-name">{{ getDisplayName() }}</h2>
            <p class="profile-email">{{ profile.email }}</p>
            <p class="profile-member-since">Member since {{ profile.createdAt ? formatDate(profile.createdAt) : 'Recently' }}</p>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value points">
              {{ profile.points || 0 }}
            </div>
            <div class="stat-label">TOTAL POINTS</div>
          </div>
          <div class="stat-card">
            <div class="stat-value rank">
              <ng-container *ngIf="userRank !== null; else rankLoading">
                #{{ userRank }}
              </ng-container>
              <ng-template #rankLoading>
                <span *ngIf="rankError; else loading">N/A</span>
                <ng-template #loading>Loading...</ng-template>
              </ng-template>
            </div>
            <div class="stat-label">GLOBAL RANK</div>
          </div>
        </div>
      </div>
      <!-- Bottom Navigation Bar (Mobile) -->
      <app-bottom-nav
        [bottomNavItems]="bottomNavItems"
        [getIconForRoute]="getIconForRoute.bind(this)"
        [isActiveRoute]="isActiveRoute.bind(this)"
        [navigate]="navigate.bind(this)">
      </app-bottom-nav>

      <!-- Edit Profile Section -->
      <div class="card">
        <h3 class="section-title">Edit Profile Image</h3>
        <form (ngSubmit)="updateProfile()" class="profile-form">
          <div class="form-group">
            <label class="form-label">Upload Profile Image</label>
            <input type="file" accept="image/*" (change)="onFileSelected($event)" class="form-input" />
          </div>
          <div *ngIf="updateMessage" 
               class="message"
               [class.message-success]="updateSuccess"
               [class.message-error]="!updateSuccess">
            {{ updateMessage }}
          </div>
          <div class="form-actions">
            <button 
              type="button"
              (click)="resetForm()"
              class="btn btn-secondary">
              Reset
            </button>
            <button 
              type="submit"
              [disabled]="isUpdating"
              class="btn btn-primary">
              {{ isUpdating ? 'Updating...' : 'Update Image' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Username Update Section -->
      <div class="card" style="margin-top: 24px;">
        <h3 class="section-title">Change Username</h3>
        <form (ngSubmit)="updateUsername()" #usernameForm="ngForm" class="profile-form">
          <div class="form-group">
            <label class="form-label">New Username</label>
            <input type="text" name="newUsername" [(ngModel)]="newUsername" required class="form-input" />
          </div>
          <div *ngIf="usernameMessage" 
               class="message"
               [class.message-success]="usernameSuccess"
               [class.message-error]="!usernameSuccess">
            {{ usernameMessage }}
          </div>
          <div class="form-actions">
            <button type="submit" [disabled]="isUpdatingUsername" class="btn btn-primary">
              {{ isUpdatingUsername ? 'Updating...' : 'Update Username' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Password Update Section -->
      <div class="card" style="margin-top: 24px;">
        <h3 class="section-title">Change Password</h3>
        <form (ngSubmit)="updatePassword()" #passwordForm="ngForm" class="profile-form">
          <div class="form-group">
            <label class="form-label">Current Password</label>
            <input type="password" name="oldPassword" [(ngModel)]="oldPassword" required class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" name="newPassword" [(ngModel)]="newPassword" required class="form-input" />
          </div>
          <div *ngIf="passwordMessage" 
               class="message"
               [class.message-success]="passwordSuccess"
               [class.message-error]="!passwordSuccess">
            {{ passwordMessage }}
          </div>
          <div class="form-actions">
            <button type="submit" [disabled]="isUpdatingPassword" class="btn btn-primary">
              {{ isUpdatingPassword ? 'Updating...' : 'Update Password' }}
            </button>
          </div>
        </form>
      </div>
<div class="logout-container" style="display: flex; justify-content: flex-end; margin: 16px 0;">
  <button 
    (click)="logout()"
    class="btn btn-primary logout-btn">
    Logout
  </button>
</div>